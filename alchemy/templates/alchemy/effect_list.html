{% extends 'base.html' %}
{% load static %}

{% block title %}All Effects{% endblock %}

{% block content %}
<h1>All Effects</h1>
<p>Click an effect name to view its ingredients.</p>

<!-- Search Box -->
<div class="input-group mb-3">
    <span class="input-group-text bg-light">
        <i class="fas fa-search"></i>
    </span>
    <input
        type="text"
        id="search-input"
        name="search"
        placeholder="Search effects or ingredients..."
        hx-get="{% url 'search_effects' %}"
        hx-trigger="keyup changed delay:300ms"
        hx-target="#effects-table-body"
        class="form-control"
    />
</div>

<!-- Effects Table -->
<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th>Icon</th>
            <th>Effect</th>
            <th>Ingredients</th>
        </tr>
    </thead>
    <tbody id="effects-table-body">
        {% for effect in effects %}
            <tr>
                <td>
                    {% if effect.icon %}
                        <img src="{{ effect.icon.url }}" alt="{{ effect.name }}" width="30" height="30" style="border-radius: 4px;" />
                    {% else %}
                        <img src="{% static 'images/no_image_placeholder.png' %}" alt="No Icon" width="30" height="30" style="border-radius: 4px;" />
                    {% endif %}
                </td>
                <td>
                    <a href="javascript:void(0);"
                       hx-get="{% url 'ingredients_for_effect_modal' effect.id %}"
                       hx-target="#modal"
                       hx-swap="innerHTML"
                       hx-trigger="click"
                    >
                        {{ effect.name }}
                    </a>
                </td>
<td>
    {% for ingredienteffect in effect.sorted_ingredienteffects %}
        <a href="{% url 'ingredient_detail' ingredienteffect.ingredient.id %}" style="display: inline-flex; align-items: center; margin-right: 10px;">
            {% if ingredienteffect.ingredient.image %}
                <img src="{{ ingredienteffect.ingredient.image.url }}"
                     alt="{{ ingredienteffect.ingredient.name }}"
                     width="20"
                     height="20"
                     style="border-radius: 4px; margin-right: 5px;" />
            {% endif %}
            {{ ingredienteffect.ingredient.name }}
        </a>{% if not forloop.last %} {% endif %}
    {% empty %}
        <em>No ingredients found</em>
    {% endfor %}
</td>

            </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Modal -->
<div id="modal-overlay" class="modal-overlay"
     onclick="document.getElementById('modal-overlay').style.display = 'none'; document.getElementById('modal').classList.remove('show')">
    <div id="modal" class="modal"
         hx-on="htmx:afterSwap: document.getElementById('modal-overlay').style.display = 'block'; document.getElementById('modal').classList.add('show')">
    </div>
</div>

<a href="/" class="btn btn-secondary mt-4">Back to Home</a>
{% endblock %}
